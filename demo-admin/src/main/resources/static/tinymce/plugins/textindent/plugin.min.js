/**
 * tinymce plugin
 * Created by jerry on 19/1/14.
 */
tinymce.PluginManager.add('textindent', function (editor) {

    function textIndent() {
        //基本变量设置

        var indentation = editor.settings.indentation;
        var ed = tinyMCE.activeEditor, d = ed.dom, s = ed.selection, e, iv, iu, st;

        st = s.getNode().style;
        var allinline = d.select('p');

        // var bfontSize = document.body.currentStyle ? document.body.currentStyle['fontSize'] :
        //
        //     document.defaultView.getComputedStyle(document.body, false)['fontSize'];

        // iu = /[a-z%]+$/i.exec(bfontSize);//获得文字的大小
        //
        // iv = parseInt(bfontSize) * 2;//俩个文字的宽度


        //实现在选取段落时候缩进段落，不选取则缩进所有段落。

        if (s.getContent() != "") {

            if (st.textIndent == "" || st.textIndent == "undefined") {
                st.textIndent = indentation;
            }
            else {
                st.textIndent = '';
            }
        } else {
            if (st.textIndent == "" || st.textIndent == "undefined") {
                d.setStyle(allinline, 'text-indent', indentation);
            } else {
                d.setStyle(allinline, 'text-indent', '');
            }
        }
    }

    editor.addCommand("mceTextIndent", textIndent);

    editor.addButton('textindent', {
        icon: 'indent',
        tooltip: '首行缩进',
        onclick: textIndent
    });

    editor.addMenuItem('textindent', {
        icon: 'indent',
        text: '首行缩进',
        context: 'tools',
        onclick: textIndent
    });
})
;